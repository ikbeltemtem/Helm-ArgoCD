

{{- range $microservice := include "myapp1.microservices" . }}
{{- $microserviceConfig := index $.Values $microservice }}
{{- if $microserviceConfig.enabled }}
{{- $serviceAccount := $microserviceConfig.serviceAccount }}
apiVersion: v1
kind: ServiceAccount
metadata:
  name: {{ default (include (printf "myapp1.%s.serviceAccountName" $microserviceConfig) $serviceAccount) .Chart.Name }}
 
  labels:
    app: {{ include "myapp1.fullname" . }}

{{- if $serviceAccount.annotations }}
  annotations:
{{ toYaml $serviceAccount.annotations | indent 4 }}
{{- end }}
{{- end }}
{{- end }}
